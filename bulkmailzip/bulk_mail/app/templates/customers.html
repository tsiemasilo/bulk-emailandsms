{% extends base %}
{% block head_extra %}
<style>
.label {
font-weight: bold;
}
#ol_values {
font-size: smaller;
}
#ol_values > li {
display: inline-block;
}
.table-unified {
margin-top: 1rem !important;
border-radius: 0.5rem !important;
overflow: hidden !important;
}
.table-unified table {
border-collapse: collapse !important;
border-spacing: 0 !important;
}
.table-header-row-unified th {
background-color: rgb(0, 0, 83) !important;
padding: 0 !important;
border: none !important;
border-radius: 0 !important;
}
.table-header-content {
display: flex !important;
justify-content: space-between !important;
align-items: center !important;
padding: 0.75rem 1rem !important;
border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
}
.table-header-content h3 {
margin: 0 !important;
font-size: 1rem !important;
font-weight: 600 !important;
color: #ffffff !important;
text-transform: uppercase !important;
letter-spacing: 0.05em !important;
background-color: transparent !important;
}
#tbl_customers thead tr:nth-child(2) th {
background-color: rgb(0, 0, 83) !important;
color: #ffffff !important;
border: none !important;
border-radius: 0 !important;
padding: 0.75rem 1rem !important;
font-weight: 600 !important;
text-transform: uppercase !important;
font-size: 0.75rem !important;
letter-spacing: 0.05em !important;
}
.table-header-actions {
display: flex !important;
gap: 0.5rem !important;
align-items: center !important;
}
.table-header-actions .action-btn,
.table-header-actions button,
.btn-add-customer,
.btn-add-group,
.btn-bulk-import {
background: #ffffff !important;
color: #374151 !important;
border: 1px solid #d1d5db !important;
padding: 0.5rem 1rem !important;
font-size: 0.813rem !important;
font-weight: 500 !important;
border-radius: 0.25rem !important;
display: inline-flex !important;
align-items: center !important;
gap: 0.4rem !important;
white-space: nowrap !important;
transition: all 0.2s ease !important;
cursor: pointer !important;
box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
}
.table-header-actions .action-btn:hover,
.table-header-actions button:hover,
.btn-add-customer:hover,
.btn-add-group:hover,
.btn-bulk-import:hover {
background: #f97316 !important;
color: #ffffff !important;
border-color: #f97316 !important;
}
.table-header-actions .action-btn svg,
.table-header-actions button svg {
width: 16px !important;
height: 16px !important;
stroke: currentColor !important;
}
</style>
{% endblock %}

{% block content %}
{% import "macros/action_icons_static.html" as icons with context %}
<span class="title"><h2>{% block title %}Customers - {{ company_name }}{% endblock %}</h2></span>
<div class="content-container content">
<div id="div_filter" class="div_data_filtering">
<form action="{{ url_for("main.customers", i_company_id=company_id) }}" method="post" id="frm_filter">
<!-- Buttons -->
<div class="filter-buttons-row">
<button type="submit" id="btn_filter" class="action-btn btn-apply-filter" value="Apply Filter" title="Apply Filter">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>
<span>Apply Filter</span>
</button>
</div>
<!-- end of div for buttons -->
<!-- div containing filter Rows -->
<div class="div_filter_row" style="margin-bottom: 20px;">
<!-- filter row -->
<div style="flex: 1 1 200px;">
<label for="sel_group_filter">Select Group</label>
<select name="sel_group_filter" id="sel_group_filter">
<option value="0">---all groups---</option>
{% for group in groups %}
<option value="{{ group.id }}"{% if group.id==group_id %} selected{% endif %}>{{ group.v_group_name }}</option>
{% endfor %}
</select>
</div>
</div>
<!-- end of first div.div_filter_row containing filter rows -->
</form>
</div><!-- end of #div_filter -->
{% if customers %}
<div class="table-container table-unified">
<table class="data-table" id="tbl_customers">
<thead>
<tr class="table-header-row-unified">
<th colspan="6">
<div class="table-header-content">
<h3>Customers</h3>
<div class="table-header-actions">
<button type="button" id="btn_add_customer" class="action-btn btn-add-customer" value="Add Customer" title="Add Customer">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>
<span>Add Customer</span>
</button>
<button type="button" id="btn_add_group" class="action-btn btn-add-group" value="Add Group" title="Add Group">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
<span>Add Group</span>
</button>
<button type="button" id="btn_upload_import" class="action-btn btn-bulk-import" value="Bulk Import" title="Bulk Import">
<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
<span>Bulk Import</span>
</button>
</div>
</div>
</th>
</tr>
<tr>
<th>Last Name</th><th>First Name(s)</th><th>E-mail Address</th><th>Mobile Number</th><th>Nationality</th><th>Actions</th>
</tr>
</thead>
<tbody>
{% for customer in customers %}
<tr>
<td>{{ customer.v_last_name }}</td><td>{{ customer.v_first_names }}</td><td class="email-cell">{{ customer.v_email }}</td><td>{{ customer.v_mobile_number }}</td><td>{{ customer.v_nationality }}</td>
<td id="td_{{ customer.id }}">
<button type="button" class="btn_edit_customer btn-icon" value="Edit Customer" title="Edit Customer" aria-label="Edit Customer">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
</button>
<button type="button" class="btn_remove_customer btn-icon" value="Remove Customer" title="Remove Customer" aria-label="Remove Customer">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
</button>
</td>
</tr>
{% endfor %}{# end of looping through customers #}
</tbody>
</table><!-- end of tbl_customers -->
{% from "macros/paging.html" import paging_basics with context %}
{{ paging_basics() }}
</div><!-- end of div.table-container -->
{% endif %}{# end of checking if customers existed #}
</div><!-- end of div.content -->
{% from "macros/dialog.html" import dlg_prep with context %}
{{ dlg_prep(["dlg_customer", "dlg_group", "dlg_upload"]) }}
{# dlg divs below #}
<div id="dlg_customer" aria-labeledby="spn_customer">
<span id="spn_customer">Customer details</span><br>
<form action="{{ url_for("main.customers", i_company_id=company_id) }}" method="post" id="frm_customer">
{{ form.csrf_token }}
<input type="hidden" name="sel_group_filter" value="{{ group_id }}">
<input type="hidden" name="hid_page" value="{{ paging.page }}">
<!-- here I am -->
{{ form.hid_customer_id }}
<!-- and done -->
<ul>
<li>{{ form.sel_id_type.label }}&nbsp;{{ form.sel_id_type }}</li>                                                                                   
<li>{{ form.txt_id_number.label }}&nbsp;{{ form.txt_id_number }}</li>                                                                               
<li>{{ form.txt_title.label }}&nbsp;{{ form.txt_title }}</li>                                                                                       
<li>{{ form.txt_first_names.label }}&nbsp;{{ form.txt_first_names }}</li>                                                                           
<li>{{ form.txt_last_name.label }}&nbsp;{{ form.txt_last_name }}</li>                                                                               
<li>{{ form.sel_gender.label }}&nbsp;{{ form.sel_gender }}</li>                                                                                     
<li>{{ form.sel_nationality.label }}&nbsp;{{ form.sel_nationality }}</li>                                                                           
<li>{{ form.txt_mobile_number.label }}&nbsp;{{ form.txt_mobile_number }}</li>                                                                       
<li>{{ form.txt_mobile_number_alternate.label }}&nbsp;{{ form.txt_mobile_number_alternate }}</li>                                                   
<li>{{ form.txt_landline_number.label }}&nbsp;{{ form.txt_landline_number }}</li>                                                                   
<li>{{ form.txt_landline_number_alternate.label }}&nbsp;{{ form.txt_landline_number_alternate }}</li>                                               
<li>{{ form.txt_email.label }}&nbsp;{{ form.txt_email }}</li>                                                                                       
<li>{{ form.txt_email_alternate.label }}&nbsp;{{ form.txt_email_alternate }}</li>                                                                   
<li>{{ form.txt_address.label }}&nbsp;{{ form.txt_address }}</li>                                                                                   
<li>{{ form.txt_street_name.label }}&nbsp;{{ form.txt_street_name }}</li>                                                                           
<li>{{ form.txt_suburb.label }}&nbsp;{{ form.txt_suburb }}</li>                                                                                     
<li>{{ form.txt_city.label }}&nbsp;{{ form.txt_city }}</li>                                                                                         
<li>{{ form.txt_province.label }}&nbsp;{{ form.txt_province }}</li>                                                                                 
<li>{{ form.txt_code.label }}&nbsp;{{ form.txt_code }}</li>
<li>{{ form.txt_postal_address.label }}<br>{{ form.txt_postal_address }}</li>
</ul>
<button type="submit" name="btn_save_customer" value="Save Customer">{{ icons.save_svg(s_label="Save Customer") }} Save Customer</button>
</form>
</div><!-- end of dlg_customer -->
<div id="dlg_group" aria-labeledby="spn_group">
<span id="spn_group">Group details</span><br>
<form action="{{ url_for("main.customers", i_company_id=company_id) }}" method="post" id="frm_group">
{{ group_form.csrf_token }}
<input type="hidden" name="hid_page" value="{{ page }}">
{{ group_form.hid_group_id }}
<ul>
<li>{{ group_form.txt_group_name.label }}&nbsp;{{ group_form.txt_group_name }}</li>
<li>{{ group_form.txt_group_description.label }}&nbsp;{{ group_form.txt_group_description }}</li>
</ul>
<button type="submit" name="btn_save_group" value="Save Group">{{ icons.save_svg(s_label="Save Group") }} Save Group</button>
</form>
</div><!-- end of dlg_group -->
<div id="dlg_upload" aria-labeledby="spn_upload">
<span id="spn_upload">Bulk Upload</span><br>
<form action="{{ url_for("main.customers", i_company_id=company_id) }}" method="post" enctype="multipart/form-data" id="frm_upload">
{{ upload_form.csrf_token }}
<input type="hidden" name="hid_page" value="{{ page }}">
<div>Upload a comma-separated-values .csv file with following columns in each row [column (max. length per value)] - possibly selecting a customer group for association -<br>
<ol id="ol_values"><li>id_number (64)</li><li>title (32)</li><li>first_names (128)</li><li>last_name (128)</li><li>gender (8)</li><li>nationality (128)</li><li>mobile_number (64)</li><li>landline_number (64)</li><li>email (128)</li><li>address (64)</li><li>street_name (64)</li><li>suburb (64)</li><li>city (64)</li><li>province (64)</li><li>postal_code (32)</li><li>postal_address (128)</li></ol>
</div>
<ul>
<li>{{ upload_form.sel_group_id.label }}&nbsp;{{ upload_form.sel_group_id }}</li>
<li>{{ upload_form.fil_upload.label }}&nbsp;{{ upload_form.fil_upload }}</li>
</ul>
<button type="submit" name="btn_upload_customers" value="Upload Customers">{{ icons.save_svg(s_label="Upload Customers") }} Upload Customers</button>
</form>
</div><!-- end of dlg_upload -->
<script type="text/javascript">
$(document).ready( function() {

try {

var s_dlg_customer = $("#dlg_customer").html();
var s_dlg_group = $("#dlg_group").html();
var s_dlg_upload = $("#dlg_upload").html();

$("#btn_add_customer").click( function() {
    $("#dlg_customer").html(s_dlg_customer);
    $("#dlg_customer").redraw();
    $("#dlg_customer").dialog("open");
});// end of #btn_add_customer click event

$("#btn_add_group").click( function() {
    $("#dlg_group").html(s_dlg_group);
    $("#dlg_group").redraw();
    $("#dlg_group").dialog("open");
});// end of #btn_add_group click event

$("#btn_upload_import").click( function() {
    $("#dlg_upload").html(s_dlg_upload);
    $("#dlg_upload").redraw();
    $("#dlg_upload").dialog("open");
});// end of #btn_upload_import click event

$("#tbl_customers").on("click", "button.btn_edit_customer", function() {
try {
    $("#dlg_customer").html(s_dlg_customer);
    $("#dlg_customer").redraw();
    var td_parent = $(this).parent();
    var s_id = String($(td_parent).attr("id")).replace("td_", "");
    var s_url = "{{ url_for("main.customer_details", i_customer_id=99999) }}".replace("99999", s_id);
    $.get(s_url, function(o_data) {
        if (typeof(o_data)=="object") {
            $("#hid_customer_id").val(s_id);
            $("#sel_id_type").val(o_data.i_id_type);
{% for s_field, s_value in {"hid_customer_id": "id", "sel_id_type": "i_id_type", "txt_id_number": "v_id_number", "txt_title": "v_title", "txt_first_names": "v_first_names", "txt_last_name": "v_last_name", "sel_gender": "v_gender", "txt_mobile_number": "v_mobile_number", "txt_mobile_number_alternate": "v_mobile_number_alternate", "txt_landline_number": "v_landline_number", "txt_landline_number_alternate": "v_landline_number_alternate", "txt_email": "v_email", "txt_email_alternate": "v_email_alternate", "txt_address": "v_address", "txt_street_name": "v_street_name", "txt_suburb": "v_suburb", "txt_city": "v_city", "txt_province": "v_province", "txt_code": "v_code", "txt_postal_address": "v_postal_address"}.items() %}
            $("#{{ s_field }}").val(o_data.{{ s_value }});
{% endfor %}
            $.each($("#sel_nationality").children("option"), function(ix, opt) {
                if ($(opt).text()==o_data.v_nationality) { $(opt).prop("selected", true); }
            });// end of looping through option children
            $("#dlg_customer").redraw();
            $("#dlg_customer").dialog("open");
        } else {
            alert("Error! " + String(o_data));
        }// end of checking if o_data is an object
    });// end of .get
} catch(e) {
    var s_err = String(e.name) + "\nmessage:" + String(e.message);
    s_err = (typeof(e.lineNumber)!="undefined") ? s_err + "\nline:" + String(e.lineNumber) : s_err;
    alert("Error! " + s_err);
}//end of catch
});// end of button.btn_edit_customer click event inside tbl_customers

$("#tbl_customers").on("click", "button.btn_remove_customer", function() {
try {
    var bl_confirm = confirm("Are you sure?");
    if (bl_confirm) {
        var td_parent = $(this).parent();
        var s_id = String($(td_parent).attr("id")).replace("td_", "");
        $("#hid_remove_customer_id").val(s_id);
        document.getElementById("frm_remove_customer").submit();
    }// end of confirmation check
} catch(e) {
    var s_err = String(e.name) + "\nmessage:" + String(e.message);
    s_err = (typeof(e.lineNumber)!="undefined") ? s_err + "\nline:" + String(e.lineNumber) : s_err;
    alert("Error! " + s_err);
}//end of catch
});// end of button.btn_remove_customer click event inside tbl_customers

function jump_page(i_page) {
    i_page = (isNaN(i_page)) ? 1 : Number(i_page);
    $("#hid_page").val(i_page);
    document.getElementById("frm_paging").submit();
}// end of jump_page function

$(".a_page_number").click( function(event) {
    event.preventDefault();
    var s_page = String($(this).attr("href")).replace("#", "");
    i_page = (isNaN(s_page)) ? 1 : Number(s_page);
    jump_page(i_page);
});// end of .a_page_number function

window.setTimeout( function() {
    var s_nada = ""; //alert("hello world");
}, 300);
var s = "nada"; // do_alert("hello world");

} catch(e) {
    var s_err = String(e.name) + "\nmessage:" + String(e.message);
    s_err = (typeof(e.lineNumber)!="undefined") ? s_err + "\nline:" + String(e.lineNumber) : s_err;
    alert("Error! " + s_err);
}//end of catch

});// end of secondary document ready
</script>
<form action="{{ url_for("main.customers", i_company_id=company_id) }}" method="post" id="frm_paging">
<input type="hidden" name="hid_page" id="hid_page" value="{{ page }}">
</form>
{% if remove_form %}
<form action="{{ url_for("main.customers", i_company_id=company_id) }}" method="post" id="frm_remove_customer">
{{ remove_form.csrf_token }}
<input type="hidden" name="hid_page" id="hid_page" value="{{ page }}">
{{ remove_form.hid_remove_customer_id }}
</form>
{% endif %}
{% endblock %}